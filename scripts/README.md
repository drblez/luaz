# Скрипты репозитория
#
# Copyright (c) 2026
#
# Objects
# - scripts: Описание скриптов и условий их использования.

## Общие условия

- Переменные окружения по умолчанию: `MF_HOST`, `MF_PORT`, `MF_USER`, `MF_PASS`, `MF_HLQ`.
- При наличии файла `.env` в корне репозитория параметры MF_* подхватываются автоматически.
- Для JCL имена JOB/STEP/DDNAME должны быть не длиннее 8 символов.

## Скрипты

### asmfmt.py

Форматирует HLASM‑исходники: табы → пробелы, перенос длинных комментариев, вынос хвостовых ремарок в отдельные `*`‑строки.  
Условия: Python 3, локальный доступ к исходникам.  
Использование: вызывается из `ftp_sync_src.sh` при наличии `.asm`.

### console_cmd.sh

Локальный wrapper для консольных команд в окружении (вспомогательный).  
Условия: зависит от локальной конфигурации; используется вручную.

### ftp_fetch_job.sh

Забирает спулы/выводы заданной job через FTP.  
Условия: заданы `MF_*` или параметры CLI; доступ к z/OS FTP.  
Связанные документы: `docs/DEV_WORKFLOW.md`.

### ftp_submit.sh

Отправляет JCL на мейнфрейм через FTP и ждёт завершения job.  
Условия: `MF_*`, доступ к FTP, JCL в `jcl/`.  
Связанные документы: `docs/DEV_WORKFLOW.md`.

### ftp_sync_all.sh

Синхронизирует все каталоги проекта в соответствующие PDS/PDSE.  
Условия: подготовлены `pds-map-*.csv`, заполнены `MF_*`.  
Использование: выполняет серию вызовов `ftp_sync_src.sh`.  
Связанные документы: `docs/DEV_WORKFLOW.md`.

### ftp_sync_src.sh

Синхронизирует выбранный каталог в заданный PDS/PDSE.  
Условия: `MF_*`, доступ к FTP, корректный `--pds`.  
Особенности: авто‑дефолты RECFM/LRECL по типу файлов, авто‑формат ASM,  
маппинг имён по умолчанию (использует `pds-map-*.csv` при наличии,  
иначе создаёт), авто‑переписывание include при наличии `pds-map-inc.csv`.  
Связанные документы: `docs/DEV_WORKFLOW.md`.

### pds_map.py

Генерирует `pds-map-*.csv` с отображением путей в имена членов.  
Условия: Python 3.  
Связанные документы: `docs/DEV_WORKFLOW.md`.

### rewrite_includes.py

Переписывает `#include "..."` на имена членов PDS для staged‑выгрузки.  
Условия: Python 3, карта `pds-map-inc.csv`.  
Использование: вызывается из `ftp_sync_src.sh`.

### sdsf_cmd.sh

Обёртка для запуска SDSF команд (вспомогательная).  
Условия: локальная конфигурация SDSF/TSO.

### update-lua.sh

Обновляет/синхронизирует Lua upstream в локальной структуре.  
Условия: доступ к исходникам и правам записи в `third_party/`.

## Связанные документы

- `docs/DEV_WORKFLOW.md` — общий workflow и примеры работы со скриптами.
- `docs/tests/README.md` — правила тестирования и запуск JCL.
